Running Tests:

##### Look at current Hashiapp:

while true; do curl -H "Host: hashiapp.com" http://104.196.183.232:9999/version; sleep 1; done

##### Update Hashiapp

gcloud compute ssh ns-1 nomad run hashiconf-napa-2016/jobs/hashiapp-v2-c10.nomad

##### Then deactivate old Hashiapp metrics:

node deactivate-complete-allocs.js -n 104.196.129.150 -t 7339c41b-48ab-617e-8859-c60ab96edb90

###### Clean up other metrics:

node deactivate-metrics.js -t 7339c41b-48ab-617e-8859-c60ab96edb90 -s '*179bc068*'

###### OR Clean up old metrics no longer marked as complete:

 
 curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90 -H "Accept: application/json" https://api.circonus.com/metric?search='*nc-5*alloc*(active:1)'


Using Nomad API to control Circonus Metrics
 - Don't get swamped by old metrics, and
 - 
 
curl http://ns-1:4646/v1/allocations | jq -c '.[] | {Name: .Name, ID: .ID, ClientStatus: .ClientStatus, DesiredStatus: .DesiredStatus}'
 

curl --user ExampleApp:7339c41b-48ab-617e-8859-c60ab96edb90 -H "Accept: application/json"  https://api.circonus.com/check?search=nomad | jq -c '.[]'
 
 
 /check?search=(host:prod.*.com)&size=10
 
 
 0ce8877a-250c-347e-4478-d416137099d9
 
 
 curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90 -H "Accept: application/json" https://api.circonus.com/metric?search='*nc-5*alloc*(active:1)'
   
   
   
curl --user ExampleApp:7339c41b-48ab-617e-8859-c60ab96edb90 \
   -H "Accept: application/json" \
   https://api.circonus.com/check?search="(host:*nc-1*)" | jq -c '.[] | {Name: ._metric_name}'

/check?search=(host:prod.*.com)&size=10


curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90    -H "Accept: application/json" https://api.circonus.com/v2/metric?search="*fa3b4740*" | python -m json.tool

curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90  -H "Accept: application/json" https://api.circonus.com/v2/metric?search='(name:*fa3b4740*)' | python -m json.tool

curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90  -H "Accept: application/json" https://api.circonus.com/v2/check?search='(metric_name:*nc-1*)' | python -m json.tool

FORMAT OUTPUT:
	python -m json.tool
	
	
	08e379ee-658d-89d1-72b7-4c7a04793359
	
	
curl --user ExampleApp:7339c41b-48ab-617e-8859-c60ab96edb90    -H "Accept: application/json" https://api.circonus.com/check_bundle/138971

curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90    -H "Accept: application/json" https://api.circonus.com/


curl --user Nomad:7339c41b-48ab-617e-8859-c60ab96edb90 -H "Accept: application/json" https://api.circonus.com/check_bundle/138971 | python -m json.tool >> foobar.json


nomad status | awk '{print $1}' | grep -v ^ID | xargs -n1 nomad status | grep running | grep -v ' = running'

nomad status | awk '{print $1}' | grep -v ^ID | xargs -n1 nomad status | grep complete | grep -v ' = complete'

$ nomad status hashiapp | awk '{print $3}' | grep -v ^0$ | xargs -n1 nomad node-status | grep Name

curl http://104.196.129.150:4646/v1/allocations | jq -c '.[] | {Name: .Name, ID: .ID, ClientStatus: .ClientStatus, DesiredStatus: .DesiredStatus}'


http://104.196.152.21:4646/v1/system/gc

curl -v -XPUT 104.196.152.21:4646/v1/system/gc
GENERATE LOAD:

yes > /dev/null &


COME BACK TO THIS:  node remove-allocations.js --token 7339c41b-48ab-617e-8859-c60ab96edb90 --allocid '*61e4e01a*'